<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.0.0-beta2
* @link https://tabler.io
* Copyright 2018-2021 The Tabler Authors
* Copyright 2018-2021 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="es">

<head>
    {% block head %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>RUTA-TEC Visualiza tu ruta, visualiza tu destino</title>
    <!-- <link rel="preload" href="/dist/libs/bootstrap-table/all.css" as="style"> -->
    <link href="/dist/css/indexbasesidebar.css" rel="stylesheet" />
    <link href="/dist/libs/jquery-treetable-master/jquery-treetable.css" rel="stylesheet" />
    <link href="/dist/css/indexbaseheader.css" rel="stylesheet" />
    <link href="/dist/css/tabler.min.css" rel="stylesheet" />
    <link href="/dist/iconfont/tabler-icons.min.css" rel="stylesheet" />
    <link href="/dist/libs/bootstrap-table/all.css" rel="stylesheet" />
    <link href="/dist/libs/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" />
    <link href="/dist/libs/select2-4.0.13/css/select2.min.css" rel="stylesheet" />
    <link href="/dist/libs/select2-4.0.13/css/select2-bootstrap.min.css" rel="stylesheet" />
    <link href="/dist/libs/filepond/filepond.min.css" rel="stylesheet" />
    <link href="/dist/libs/filepond/filepond-plugin-get-file.min.css" rel="stylesheet" />
    <style>
          /*Head del sidebar*/
        .verticalText {
          writing-mode: vertical-lr;
          transform: rotate(180deg);
        }
        .sidebar-brand.head{
          background: rgb(49, 84, 243);
        }
        .nav-tabs .agrupador.show .nav-link,
        .nav-tabs .nav-link.active {
            font-weight: bold;
            color: black;
        }
        
        .hr-text {
          margin: .8rem 0;
        }

        .full_modal-dialog {
            width: 98% !important;
            height: 92% !important;
            min-width: 98% !important;
            min-height: 92% !important;
            max-width: 98% !important;
            max-height: 92% !important;
            padding: 0 !important;
        }
        
        .full_modal-content {
            height: 99% !important;
            min-height: 99% !important;
            max-height: 99% !important;
        }

        /* FilePond Custom Styles
       .filepondAbilitado{
            background-color: #2FB344;
            color: white;
        }
        /* .filepond--drop-label{
            background-color: #06D497;
            color: white;
        } 
        .filepondDisabled{
          background-color: #4e3bfd;
          color: gray;
          font-weight: bold;
        } */
        .select2-search__field {
          width: 100%!important;
        }
        .fotoperfil {
            border-radius: 20px;
            object-fit: cover;
            object-position: center;
            width:74%;
            height:74%;
            margin-left: 13%; 
            margin-top: 2%;
        }
        .was-validated .custom-select:invalid + .select2 .select2-selection{
          border-color: #dc3545!important;
        }
        .form-select.is-valid, .was-validated .form-select:valid{
          background-image :none!important; 
          /*Eliminar el ícono establecido por el cambio reciente en donde se quita la librería select2 para hacerlo de solo lectura*/
        }
        .was-validated .custom-select:valid + .select2 .select2-selection{
          border-color: #28a745!important;
        }
        *:focus{
          outline:0px;
        }
    /*Validaciones particulares para casos necesarios*/
      .invalido{
        border-color: #dc3545!important;
        border-color: #dc3545!important;
        padding-right: calc(1.5em + 0.75rem)!important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23dc3545' viewBox='-2 -2 7 7'%3e%3cpath stroke='%23dc3545' d='M0 0l3 3m0-3L0 3'/%3e%3ccircle r='.5'/%3e%3ccircle cx='3' r='.5'/%3e%3ccircle cy='3' r='.5'/%3e%3ccircle cx='3' cy='3' r='.5'/%3e%3c/svg%3E")!important;
        background-repeat: no-repeat!important;
        background-position: center right calc(0.375em + 0.1875rem)!important;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem)!important;
      }
      /*Para disminuir los espacios entre los labels y los inputs generados por la macro rowinput*/
      .form-label { 
        margin-bottom: 0rem;
      }
      #buscadorR {
        width: 180px; 
        height: 40px; 
        left: 40px; 
        position: relative;
      }
      /*Animacion de despliegue*/
      #root li ul{
      	transition: all 0.3s ease-out;
      }
	    /*Animación de los iconos*/
	    @keyframes swing {
	      0%, 30%, 50%, 70%, 100% {
	        transform: rotate(0deg);
	      }
	      10% {
	        transform: rotate(10deg);
	      }
	      40% {
	        transform: rotate(-10deg);
	      }
	      60% {
	        transform: rotate(5deg);
	      }
	      80% {
	        transform: rotate(-5deg);
	      }
	    }
	    li.sidebar-dropdown a:hover i{
	      display: inline-block;
	      animation: swing ease-in-out 0.4s 1 alternate;
	    }
	    /*Icono posicion, tamaño y animacion*/
	    #icono1{
	      position: relative;
	      font-size: 15px;
        float: right;
        font-weight: bold;        
        -moz-transition: all 0.25s ease-out;
        -ms-transition: all 0.25s ease-out;
        -o-transition: all 0.25s ease-out;
        -webkit-transition: all 0.25s ease-out;
      }
	    /*Animacion de la flecha*/
	    li.nav-item:hover a #icono1 {
	      -moz-transform: rotate(90deg);
        -ms-transform: rotate(90deg);
        -o-transform: rotate(90deg);
        -webkit-transform: rotate(90deg);
	    }
	    /*Agrupadores color de fondo y letras*/
	    .contenedor #agrup{
	      font-weight: bold;
	      color: #ffff;
	      font-size: 14px;
	      padding: 8px 5px;
	      background: #00546f;/*rgb(0, 177, 136); #00546F*/
	    }
	    /*Animacion para los agrupadores*/
	    .contenedor  #agrup:hover{
	      padding: 8px 12px;
        background-color: #ecfd00;
	    }
	    /*Cambiar de fondo a los módulos*/
	    #root .sidebar-dropdown a {
        /*#00546F #c6c6c6 #e2e3e7 #ffff*/
	      color: #454546;
	    }
	    #root .sidebar-dropdown:hover a {
	      /*background:  #00B188 rgb(0, 177, 136)*/
	      color: black;
	      padding: 6px 25px;
	    }

      /*Elimina los botones del input tipo number*/
      .ExepbtnNumber::-webkit-inner-spin-button{
            -webkit-appearance: none;
            margin: 0;
      }
      /*Estilo para el tab de archivos*/
      .backgroundTabReporte{
        color: #ffff!important;
        background: #008080!important;
      }
      .opcionActRegresar {
        color: #7F7C7C!important;
      }

      #btnproy, #btnindi, #btnres, #btnact, #btnppto, #btnProy{
        color: #00546f!important;
        border-color: rgb(0, 177, 136) !important;
      }
      .icon{
        color: rgb(0, 177, 136)!important;
      }
      #observaciones{
        overflow: auto; 
        margin-top: 10px;
      }
      #contenido{
        background-color: white; 
        border:none;
      }
      .titulo{
        font-size: 15px; 
        background-color: white;
      }
      .fecha{
        font-size: 12px; 
        background-color: white;
      }
      #map {
	      height: 695px;
	      width: 100%;
        background-color: grey;
     }
     .Short, .NoPass {
    width: 100%;
    background-color: #dc3545;
    margin-top: 5px;
    height: 3px;
    color: #dc3545;
    font-weight: 500;
    font-size: 12px;
    }
    .Weak {
      width: 100%;
      background-color: #ffc107;
      margin-top: 5px;
      height: 3px;
      color: #ffc107;
      font-weight: 500;
      font-size: 12px;
    }
    .Strong, .Pass {
      width: 100%;
      background-color: #02fb13;
      margin-top: 5px;
      height: 3px;
      color: #02fb13;
      font-weight: 500;
      font-size: 12px;
    }
    </style>
    {% endblock %}
</head>
<body class="antialiased" style="background-color: #F4F6FA">
    <!-- Navbar -->
    <div id="sidebar" class="page-wrapper chiller-theme">
        <nav class="menu-horizontal navbar navbar-expand-md navbar-light bg-white position-fixed z-index-1" style="padding: 0; margin: 0;">
            <div class="container-fluid">
                <h6 class="logo active text-dark">
                  <a href="/">
                    <img src="/sites.png" width="100" height="100" style="position: relative; left: 25%;">
                  </a>
                  <div> <label>RUTA-TEC Visualiza tu ruta, visualiza tu destino</label></div>
                  <!-- <div class="col-12">Two <input type="button" class="btn btn-outline-primary float-right" value=".float-right"></div> -->
                </h6>
                <!-- <form class="d-flex" >
                  <input id="Buscar" class="form-control me-2" type="text" placeholder="Busca una ruta">
                </form> -->
               <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="ti ti-line-height h1"></span>
                </button> -->
                
                <div class="navbar-nav flex-row order-md-last" id="navbarText">
                    <div id="fotoram" name="fotoram" class="agrupador dropdown mx-2">
                      <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                       <!-- <button type="button" class="btn border-0 dropdown-toggle" data-bs-toggle="dropdown"> -->
                            <span id="imaqwe" class="avatar avatar-md avatar-rounded">
                              <img src="/perfil.png">
                            </span>
                            <div class="d-none d-lg-block ps-2">
                              <div><strong></strong></div>
                              <div class="mt-1 small text-muted"></div>
                            </div>
                        <!-- </button> -->
                      </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a class="dropdown-item" id="Historial" href="#" data-bs-toggle="modal" data-bs-target="#modal-historial" onclick="historial()">
                                Historial
                            </a>  
                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-editarperfil" onclick="verMiPerfil()">
                                Editar perfil
                            </a>
                            <a class="dropdown-item" href="#" onclick="location.replace('/logout');">
                                Cerrar sesión
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <a id="show-sidebar" class="text-dark" href="#">
            <i class="navbar-toggler-icon"></i>
        </a>
        <nav id="sidebar" class="sidebar-wrapper" >
          <div class="sidebar-content">
              <div class="sidebar-brand head" style="background-color: #00546f;">
                  <div id="close-sidebar">
                      <i class="ti ti-x"></i>
                  </div>
              </div>
              <div class="sidebar-search" >
                  <div class="hr-text">
                    <i class="ti ti-device-desktop"></i>
                    Rutas
                  </div>
              </div>
              <div class="sidebar-menu" id="accordion">
                <div class="conteiner-fluid" >
                    <input class="form-control me-2 search" id="buscadorR" type="text" placeholder="Buscar una ruta"/>
                    <br>
                  </div>
                  <ul id="ulMenuMain"></ul><br>      
                  <ul id="root" class="contenedor">
                    <!-- <li class="nav-item" id="clon_ruta">
                      <input type="hidden" class="idruta" id="ruta_id" required disabled style="display:none;">
                      <input type="text" class="form-control Ruta" id="ruta_n" required disabled style="display:none;">
                    </li> -->
                  </ul>
              </div>
              <!-- sidebar-menu  -->
          </div>
          <!-- sidebar-content  -->
          <div class="sidebar-footer">
              <a href="/about_us" class="text-dark" >
                  <i class="ti ti-info-circle h2" data-bs-toggle="tooltip" data-bs-placement="top" title="Acerca de"></i>
                  Acerca de...
              </a>
              <a href="/about_us" class="text-dark" >
                <i class="ti ti-user h2" data-bs-toggle="tooltip" data-bs-placement="top" title="Tour"></i>
                Tour
            </a>
              <br>
              <br>
          </div>
      </nav>  
        <!-- sidebar-wrapper  -->
        <div id="map"></div>        
        <!-- page-content" -->
    <div class="modal modal-blur fade" id="modal-editarperfil" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Mi Perfil</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="card">
              <ul class="nav nav-tabs nav-tabs-alt" data-bs-toggle="tabs">
                <li class="agrupador">
                <a href="#tabs-micuenta" class="nav-link active" data-bs-toggle="tab">
                  <i class="ti ti-home h2 me-2"></i>
                  Mi cuenta</a>
                </li>
                <li class="agrupador">
                <a href="#tabs-contraseña" class="nav-link" data-bs-toggle="tab">
                  <i class="ti ti-user h2 me-2"></i>
                  Actualizar Contraseña</a>
                </li>
              </ul>
              <div class="card-body">
                <div class="tab-content card-body">
                  <!-- tab de datos de cuenta-->
                  <div class="tab-pane show active" id="tabs-micuenta">
                    <form id="form_perfil_edit" class="needs-validation" autocomplete="off" novalidate>
                      <div class="mb-3 form-group">
                        <div class="input-icon mb-3">
                          <input type="hidden" id="id_user" name="id" required>
                        </div>   
                      </div>
                      <div class="mb-3 form-group">
                        <label class="form-label">Nombre</label>
                        <div class="input-icon mb-3">
                          <span class="input-icon-addon">
                            <i class="ti ti-user"></i>
                          </span>
                          <input type="text" id="name_ed" name="nombre" class="form-control" value=""  placeholder="Capture su Nombre" pattern="[A-Za-zÁÉÍÓÚáéíóúñÑÜü^,^.\s]{3,100}" required disabled/>
                          <div class="invalid-feedback">Ingrese su Nombre sin caracteres especiales. ( ), [ ], { }...</div>
                        </div>   
                      </div>
                      <div class="mb-3 form-group">
                        <label class="form-label">Apellido</label>
                        <div class="input-icon mb-3">
                          <span class="input-icon-addon">
                            <i class="ti ti-user"></i>
                          </span>
                          <input type="text" id="apellido_ed" name="apellidos" class="form-control" placeholder="Capture su Apellido " pattern="[A-Za-zÁÉÍÓÚáéíóúñÑÜü^,^.\s]{3,100}" required disabled/>
                          <div class="invalid-feedback">Ingrese su Apellido sin caracteres especiales. ( ), [ ], { }...</div>
                        </div>   
                      </div>
                      <div class="mb-3 form-group">
                        <label class="form-label">Cuenta</label>
                        <div class="input-icon mb-3">
                          <span class="input-icon-addon">
                            <i class="ti ti-mail"></i>
                          </span>
                          <input type="email" id="correo_ed" name="correo" class="form-control" value=""  placeholder="Capture su cuenta" required disabled/>
                          <div class="invalid-feedback">Ingresa un correo, ej: example@gmail.com</div>
                        </div>   
                      </div>
                      <div class="mb-3 form-group">
                        <div class="row">
                          <div class="col">
                            <button id="edit_true" name="editar_true" type="button" class="btn btn-primary w-100 edit_true">
                            Editar Usuario
                            </button>
                          </div>
                          <div class="col">
                            <button id="edit_user" type="submit" class="btn btn-success w-100 edit_user" disabled>
                              Guardar
                            </button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                  <div class="tab-pane" id="tabs-contraseña">
                    <form id="perfil_password" class="card-body needs-validation" autocomplete="off" novalidate>
                      <div class="mb-3 form-group">
                        <div class="input-icon mb-3">
                          <input type="hidden" id="id_userp" name="id" required>
                        </div>   
                      </div>
                      <div class="mb-3 form-group">
                        <label class="form-label">Password Actual</label>
                        <div class="row">
                          <div class="col">
                            <div class="input-icon">
                              <span class="input-icon-addon">
                                <i class="ti ti-lock"></i>
                              </span>
                              <input type="password" id="passwordactual" name="passwordactual" value="" class="form-control"  minlength="8" placeholder="Capture su Password" required/>
                              <div class="invalid-feedback">Se deben de introducir mínimo 8 caracteres</div>
                            </div>
                          </div>
                          <div class="col-auto">
                            <span class="input-group-text btn-show-pass bg-white">
                              <a style="text-decoration: none;" onclick="passwordShowHidde('passwordactual')" href="#" class="link-secondary"
                                title="Show password" data-bs-toggle="tooltip">
                                <i id="password-eye" class="ti ti-eye"></i>
                              </a>
                            </span>
                          </div>
                        </div>              
                      </div>

                      <div class="mb-3 form-group">
                        <label class="form-label">Nuevo Password</label>
                        <div class="row">
                          <div class="col">
                            <div class="input-icon">
                              <span class="input-icon-addon">
                                <i class="ti ti-lock"></i>
                              </span>
                              <input type="password" id="passwordnvo" name="passwordnvo" value="" class="form-control"  minlength="8" placeholder="Capture su Password" required/>
                              <!-- <div class="invalid-feedback">Se deben de introducir mínimo 8 caracteres</div> -->
                              <div id="strengthMessage2"></div>
                            </div>
                          </div>
                          <div class="col-auto">
                            <span class="input-group-text btn-show-pass bg-white">
                              <a style="text-decoration: none;" onclick="passwordShowHidde('passwordnvo')" href="#" class="link-secondary"
                                title="Show password" data-bs-toggle="tooltip">
                                <i id="password-eye" class="ti ti-eye"></i>
                              </a>
                            </span>
                          </div>
                        </div>              
                      </div>
                      
                      <div class="mb-3 form-group">
                        <label class="form-label">Repetir Nuevo Password</label>
                        <div class="row">
                          <div class="col">
                            <div class="input-icon">
                              <span class="input-icon-addon">
                                <i class="ti ti-lock"></i>
                              </span>
                              <input type="password" id="passwordnvo2" name="passwordnvo2" value="" class="form-control"  minlength="8" placeholder="Capture su Password" required/>
                              <div Id="mensaje_error2"></div>
                            </div>
                          </div>
                          <div class="col-auto">
                            <span class="input-group-text btn-show-pass bg-white">
                              <a style="text-decoration: none;" onclick="passwordShowHidde('passwordnvo2')" href="#" class="link-secondary"
                                title="Show password" data-bs-toggle="tooltip">
                                <i id="password-eye" class="ti ti-eye"></i>
                              </a>
                            </span>
                          </div>
                        </div>              
                      </div>
                      <div class="form-footer">
                        <button id="update_password" name="update_password" type="submit" class="btn btn-success w-100">
                        Guardar Cambios
                        </button>
                      </div>
                    </form>

                  </div>
                </div>
              </div>
            </div>
          </div>


        </div>
      </div>
    </div>
    <!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="modal-historial" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel"> Historial de Rutas</h5>
        <button type="button" id="Cmodal" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div class="modal-body" id="Hbody">
        <form id="form_elimH" class="needs-validation" autocomplete="off" novalidate>
          <div class="table-responsive">
            <table class="table table-vcenter">
              <thead>
                <tr class="text-center">
                  <th>Borrar/Regresar</td>
                  <th></th>
                  <th></th>
                  <th>Nombre de la ruta</td>
                  <th>Fecha de consulta</td>
                  <th>Ver ruta</td>
                </tr>
              </thead>
              <tbody id="tabla-historial">
                <tr id="ultima-fila-historial">
                  <td>
                      <button class="btn btn-danger btnDel_pas ti ti-trash" type="button" id="btnDel_pas" style="display:none"></button>  
                      <button class="btn btn-warning  ti ti-arrow-back btnBack_pas" type="button" id="btnBack_pas" style="display:none"></button>         
                  </td>
                  <td>
                    <input type="hidden" class="form-control oper" id="h_operacion" name="operacion[]" disabled value="BD" style="display:none">
                  </td>
                  <td>
                    <input type="hidden" class="form-control id" id="id" name="id[]" disabled value="0" style="display:none">
                  </td>
                  <td>
                    <input class="form-control  Rnombre text-center" type="text" id="h_nombre" name="nombre[]" disabled style="display:none">
                  </td>
                  <td>
                    <input type="date" class="form-control fecha text-center" id="h_fecha" name="fecha[]" disabled style="display:none">
                  </td>
                  <td>
                    <button class="btn btn-success btnVer_pas ti ti-car" type="button" id="btnVer_pas" style="display:none"></button>  
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="form-footer">
              <button id="btnGuardarHistorial" name="btnGuardarHistorial" type="submit" class="btn btn-success w-10" disabled>
              Guardar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
  <footer class="footer bg-white" style="padding: 0rem 0;">
        <div class="container">
            <div class="row">
                <div class="col-lg-2">
                    <center>
                        <div class="hr-text text-primary">Versión</div>
                        <p>V 0.0.1</p>
                    </center>
                </div>
                <div class="col-lg-3">
                    <center>
                        <div class="hr-text text-primary">Nombre de la empresa</div>
                        <p>Sistemas Tecnológicos de la Selva</p>
                    </center>
                </div>
                <div class="col-lg-3">
                    <center>
                        <div class="hr-text text-primary">Contacto</div>
                        <p>Ocosingo, Chiapas, México. C.P. 29950</p>
                        <p>Sites2022GyDS@gmail.com</p>

                    </center>
                </div>
                <div class="col-lg-3">
                    <center>
                        <div class="hr-text text-primary">Redes Sociales</div>
                        <div>
                            <div class="form-selectgroup">
                              <a href="#" class="btn btn-outline-primary mx-2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Facebook">
                                <i class="ti ti-brand-facebook"></i>
                              </a>
                              <a href="#" class="btn btn-outline-info mx-2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Twitter">
                                <i class="ti ti-brand-twitter"></i>
                              </a>
                              <a href="#" class="btn btn-outline-success mx-2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Whatsapp"> 
                                <i class="ti ti-brand-whatsapp"></i>
                              </a>
                              <a href="#" class="btn btn-outline-danger mx-2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Sitio web">
                                <i class="ti ti-world"></i>
                              </a>
                            </div>
                          </div>
                    </center>
                </div>
            </div>
        </div>
        <div class="" style="background-color: #5083e9">
          <div class="text-center">
              <p class="h5 text-dark">Copyright &copy; 2021 Sites Rutatec</p>
          </div>
        </div>
  </footer>
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
{% block jsfiles %}
    <script src="/dist/libs/bootstrap/jquery.min.js"></script>
    <script src="/dist/libs/bootstrap/popper.min.js"></script>
    <script src="/dist/libs/bootstrap/bootstrap.min.js"></script>
    <script src="/dist/js/tabler.min.js"></script>
    <script src="/dist/libs/serializejson/jquery.serializejson.js"></script>
    <script src="/dist/libs/sweetalert2/sweetalert2.all.min.js"></script>

    <script src="/dist/libs/apexcharts/dist/apexcharts.min.js"></script>
    
    <script src="/dist/libs/d3.v5.min.js"></script>


    <script src="/dist/libs/bootstrap-table/jspdf.min.js"></script>
    <script src="/dist/libs/bootstrap-table/jspdf.plugin.autotable.js"></script>
    <script src="/dist/libs/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="/dist/libs/bootstrap-table/bootstrap-table-export.min.js"></script>
    <script src="/dist/libs/select2-4.0.13/js/select2.min.js"></script>
    <script src="/dist/libs/select2-4.0.13/js/es.js"></script>

    <script src="/dist/libs/bootstrap-table/bootstrap-table-es-MX.js"></script>
    <script src="/dist/libs/bootpag/jquery.bootpag.min.js"></script>

    <script src="/dist/js/indexbasesidebar.js"></script>
    <script src="/dist/js/login.js"></script>
    <script src="/dist/js/scripts.js"></script>
    <script src="/dist/js/counter.js"></script>
    <script src="/dist/libs/numeral-2.0.6/numeral.min.js"></script>
    
    <script async defer 
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSG6rPxXP8g92omTJIJg1qCM2vUD_vK4o&callback=initMap">
    </script>

<script>
  var path = [];
  var polyline;

  $(document).ready(function(){
    showrutas();
    terminales();
  });

  var cambioDePass2 = function() {
    var cont = $('#passwordnvo').val();
    var cont2 = $('#passwordnvo2').val();

    if (cont !== cont2 || cont2.length == '' || cont.length == '') {
      $('#mensaje_error2').removeClass();
      $('#mensaje_error2').addClass('NoPass');
      $('#mensaje_error2').html('Las contraseñas no coinciden');
      $('#passwordnvo2').removeClass('is-valid');
      $('#passwordnvo2').addClass('is-invalid');
      $('#update_password').prop('disabled', true);
    } else {
      $('#mensaje_error2').removeClass();
      $('#passwordnvo2').removeClass('is-invalid');
      $('#mensaje_error2').addClass('Pass');
      $('#passwordnvo2').addClass('is-valid');
      $('#mensaje_error2').html('Las contraseñas coinciden');
      $('#update_password').prop('disabled', false);
    }

  }

  $('#passwordnvo').keyup(function(){
    var password = $('#passwordnvo').val();
    var strength = 0;

    if (password.length < 7) {
      $('#strengthMessage2').removeClass();
      $('#strengthMessage2').addClass('Short');
      $('#strengthMessage2').html('La contraseña es muy corta necesitas 8 caracteres');
      $('#password').addClass('is-invalid');
      return 'Too short'
    }
    if (password.length > 8 || password.length == 8) strength += 1
    if (password.match(/([a-zA-Z])/) && password.match(/([0-9])/)) strength += 1
    if (password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)) strength += 1
    if (password.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,%,&,@,#,$,^,*,?,_,~])/)) strength += 1

    if (strength < 2) {
        $('#strengthMessage2').removeClass();
        $('#strengthMessage2').addClass('Weak');
        $('#strengthMessage2').html('La contraseña es poco segura');
        $('#password').addClass('is-invalid');
        return 'Weak'
    } else if (strength == 2) {
        $('#strengthMessage2').removeClass();
        $('#strengthMessage2').addClass('Strong');
        $('#strengthMessage2').html('La contraseña es segura');
        $('#password').removeClass('is-invalid');
        $('#password').addClass('is-valid');
        return 'Strong'
    }
  });

  $("#passwordnvo").on('keyup', cambioDePass2);
  $("#passwordnvo2").on('keyup', cambioDePass2);

  function initMap(data, terminales){

    var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 15,
    center: { lat: 16.90864465926933, lng: -92.08949481639918},
    });
    

    // Función para las terminales
    $.each(terminales, function(index, termin){
      latLng = new google.maps.LatLng(parseFloat(termin[1]), parseFloat(termin[2]));
      var marker = new google.maps.Marker({
        position: latLng,
        map: map,
        icon: {
          url: '/static/autobus.png',
          scaledSize:new google.maps.Size(32, 32)
        },
        title: termin[0]
      });
    });
    // Función para las polilíneas
    $.each(data, function(index, cord){
      path.push({lat: parseFloat(cord[0]), lng: parseFloat(cord[1])});
    });
    var color = "#" + Math.random().toString(16).slice(-3);
    polyline = new google.maps.Polyline({
        path: path,
        geodesic: true,
        strokeColor: color,
        strokeOpacity: 0.9,
        strokeWeight: 7,
    });
    // Función para medir el tiempo
    firstvalue = new google.maps.LatLng(path[0]);
    lastvalue = new google.maps.LatLng(path[path.length-1]);
    var directionsService = new google.maps.DirectionsService();

    directionsService.route({
      origin: firstvalue,
      destination:  lastvalue,
      travelMode: 'TRANSIT',
      drivingOptions:{
        departureTime: new Date(Date.now()),
        trafficModel: 'pessimistic'
      }
    }, function(response, status){
      if(status == google.maps.DirectionsStatus.OK){
        var route = response.routes[0];
        var duration = 0;
        route.legs.forEach(function (leg) {
          // The leg duration in seconds.
          duration += leg.duration.value;
        });
        const segundos = (Math.round(duration % 0x3C)).toString();
        const horas    = (Math.floor(duration / 0xE10)).toString();
        const minutos  = (Math.floor(duration / 0x3C ) % 0x3C).toString();
        const tiempo = 'Llegarás a tu destino en: \n' + horas + ' Horas ' + minutos + ' Minutos '+ ' y ' + segundos + ' Segundos';
        showMsgToastTemp('top-end', 3000, 'info', tiempo);
      }
    });
    polyline.setMap(map);
    path = [];
  }

  function terminales(){
    $.ajax({
      type: 'GET',
      url:"api/terminales",
      contentType: 'aplication/json',
      success:function (data, textStatus, jqXHR){
        initMap('', data.data);
      },
      error: function(jqXHR, textStatus, error) {
          console.log(jqXHR); console.log(textStatus); console.log(error);
          showMsgTemporal(4000, 'error', 'ERROR', jqXHR.responseJSON.detail);
        }
    })
  }

  function verMiPerfil(){
    $.ajax({
      type: 'GET',
      url:"api/user/perfil",
      contentType: 'aplication/json',

      success:function (data,textStatus,jqXHR){
        // 
        $('#edit_user').prop('disabled', true);
        $('#name_ed').prop('disabled', true);
        $('#apellido_ed').prop('disabled', true);
        $('#correo_ed').prop('disabled', true);


        $('#id_user').val(data["id"]);
        $('#id_userp').val(data["id"]);
        $('#name_ed').val(data["nombre"]);
        $('#apellido_ed').val(data["apellidos"]);
        $('#correo_ed').val(data["correo"]);
        

      },
      error: function(jqXHR, textStatus, error) {
          console.log(jqXHR); console.log(textStatus); console.log(error);
          showMsgTemporal(4000, 'error', 'ERROR', jqXHR.responseJSON.detail);
        }
    });
    
  }

  $('.edit_true').click(function( event ) {
    $('#edit_user').prop('disabled', false);
    $('#name_ed').prop('disabled', false);
    $('#apellido_ed').prop('disabled', false);
    $('#correo_ed').prop('disabled', false);
      
  });
  
  $("#form_perfil_edit").submit(function(e){

    e.preventDefault();
    $("#form_perfil_edit").addClass("was-validated");
    formDado = "form_perfil_edit";
    if (!$(this)[0].checkValidity()){
        $('#' + formDado + ' .invalid-feedback').each(function () {
            if ($(this)[0].offsetParent){
                $(this).parent().find("select, input, textarea").first().focus();
                return false; // exit each
            }
        });
        return;
    }
    let referencia = "index.html_form_perfil_edit";
    let url = "/api/user/updateuser";
    let typeSubmit = "POST";
    let ret = "{{ret}}";
    let msg = "Se actualizaron los datos correctamente";

    serializedData = JSON.stringify($(this).serializeJSON());
    sendDatosToServer(referencia, url, typeSubmit, ret, serializedData).then((jqXHR) => {
      showMsg(jqXHR[0], referencia, url, ret).then((result) => {
          if (jqXHR[0].status == 200){
            verMiPerfil()
          }
          return true;
      });
    });
  })
    
  function menuappendmenu(rutas){
    $.each(rutas, function(index, ruta){
      $('#root').append(`
        <li class="mnuRaiz nav-item" id="rutaP_${ruta[0]}">
          <a href="#sub_id_${ruta[0]}" id="agrup" class="accordion-collapse collapse" data-toggle="collapse" aria-expanded="true">
          ${ruta[1]}
          <i id="icono1" class="ti ti-chevron-right"></i>
          </a>
            <ul class="subMenusRoot collapse list-unstyled" id="sub_id_${ruta[0]}" data-parent="#accordion">
            </ul>
        </li>
      `);
    });
  };
    
  $("#perfil_password").submit(function(e){
    e.preventDefault();
    $("#perfil_password").addClass("was-validated");
    formDado = "perfil_password";
    if (!$(this)[0].checkValidity()){
        $('#' + formDado + ' .invalid-feedback').each(function () {
            if ($(this)[0].offsetParent){
                $(this).parent().find("select, input, textarea").first().focus();
                return false; // exit each
            }
        });
        return;
    }
    let referencia = "index.html_perfil_password";
    let url = "/api/user/updatepass";
    let typeSubmit = "PUT";
    let ret = "{{ret}}";
    let msg = "Se actualizo correctamente la contraseña";

    serializedData = JSON.stringify($(this).serializeJSON());
    sendDatosToServer(referencia, url, typeSubmit, ret, serializedData).then((jqXHR) => {
      showMsg(jqXHR[0], referencia, url, ret).then((result) => {
          if (jqXHR[0].status == 200){
            $("#perfil_password").removeClass("was-validated");
            $('#perfil_password').trigger('reset');
            $('#passwordnvo2').removeClass('is-valid');
            $('#mensaje_error2').remove();
            $('#strengthMessage2').remove();
          }
          return true;
      });
    });

  })

  function subrutas(idItemUL, listado, soloMenus){
    $.each(listado, function(index, valor) {
      var idmen = idItemUL + valor[0];
      if ( soloMenus ){
        idmen = idItemUL;
		}
        $(idmen).append(`
            <li id="ruta" class="sidebar-dropdown" >
              <a href="#" id="verruta" onclick="verrutas(${valor[0]})">
                <i class="ti ti-car"></i>
                Ver ${valor[1]}
              </a>
            </li>
            <li class="sidebar-dropdown">
              <a href="#">
                ${valor[2]}
              </a>
            </li>
          `);
    });
  }
</script>
  
<script>
  var numRfilas = 0;
  var idR = 0;

  function showrutas(){
    $.ajax({
      type: 'GET',
      url: '/api/sidebar',
      contentType: 'application/json',
      success: function (data, textStatus, jqXHR) {
        // Se mandan a llamar las funciones del Sidebar para las rutas.
        menuappendmenu(data.data);
        subrutas('#sub_id_', data.data);
        $('#buscadorR').keyup(function(){
          listaR = data.data;
          if($('#buscadorR').val().length >= 1){
            var similar = listaR.filter(function(objeto){
              return objeto[2].normalize("NFD").replace(/[\u0300-\u036f]/g, '').toLowerCase().includes($('#buscadorR').val().trim().toLowerCase());
            });
            $('#root').empty();
            menuappendmenu(similar);
            subrutas('#sub_id_', similar);
          }else{
            $('#root').empty();
            menuappendmenu(data.data);
            subrutas('#sub_id_', data.data);
          }
        });
      }
    });
  }
  
  function verrutas(id) {
    $.ajax({
      type: 'GET',
      url: '/api/puntrutas/'+ id,
      contentType: 'application/json',
      success: function (data, textStatus, jqXHR) {
        initMap(data.data[1]);
        $('#close-sidebar').trigger('click');
      },
      error: function (jqXHR, textStatus, error) {
        console.log(jqXHR); console.log(textStatus); console.log(error);
        if (jqXHR.status == 406) {
            showMsgTemporal(4000, 'warning', 'ATENCIÓN', jqXHR.responseJSON.detail);
        }
        else {
            showMsgTemporal(4000, 'error', 'ERROR', jqXHR.responseJSON.detail);
        }
      }
    });
  }
  
  function historial() {
    $.ajax({
      type: 'GET',
      url: '/api/historial',
      contentType: 'application/json',
      success: function (data, textStatus, jqXHR) {
        numRfilas = 0;
        $('.clonadoH').each(function(){$(this).remove();})
        $.each(data.historial[1], function(index, valor){
          ClonarH('BD');
          $('#h_id'+numRfilas).val(valor[0]);
          $('#h_oper'+numRfilas).val('BD');
          $('#h_nombre'+numRfilas).val(valor[1]);
          $('#h_fecha'+numRfilas).val(valor[2]);
        });
        
      },
      error: function (jqXHR, textStatus, error) {
        console.log(jqXHR); console.log(textStatus); console.log(error);
        if (jqXHR.status == 406) {
            showMsgTemporal(4000, 'warning', 'ATENCIÓN', jqXHR.responseJSON.detail);
        }
        else {
            showMsgTemporal(4000, 'error', 'ERROR', jqXHR.responseJSON.detail);
        }
      }
    });
  }

  function ClonarH(nodb){
    numRfilas ++;
    let nvafilaPas = $('#ultima-fila-historial').clone(true, true);
    nvafilaPas.attr('id', 'tr_'+ numRfilas);
    $('#tabla-historial').find("tr:last").before(nvafilaPas); // Añadir nueva fila despues de la ultima
    //Campos dentro de la tabla para clonar
    nvafilaPas.find('.btnDel_pas').attr('id','btnDel_pas_'+numRfilas);
    nvafilaPas.find('.btnBack_pas').attr('id','btnBack_pas_'+numRfilas);

    nvafilaPas.find('.id').attr('id','h_id'+numRfilas);
    nvafilaPas.find('.oper').attr('id','h_oper'+numRfilas);
    nvafilaPas.find('.Rnombre').attr('id','h_nombre'+numRfilas);
    nvafilaPas.find('.fecha').attr('id','h_fecha'+numRfilas);
    nvafilaPas.find('.btnVer_pas').attr('id','btnVer_pas_'+numRfilas);

    nvafilaPas.show(); // mostrar la fila

    $('#h_id'+numRfilas).show().prop('disabled', false);
    $('#h_oper'+numRfilas).show().prop('disabled', false);
    $('#h_nombre'+numRfilas).show().prop('disabled', false);
    $('#h_fecha'+numRfilas).show().prop('disabled', false);
    $('#tr_'+numRfilas).addClass('clonadoH');

    if (nobd = 'BD'){
        $('#btnDel_pas_'+numRfilas).show();
        $('#btnVer_pas_'+numRfilas).show();
        $('#btnEliminar_pas_'+numRfilas).remove();
    }
  }

  $('.btnVer_pas').click(function(e){
    var idR = $(this).attr('id');
    let numH = idR.substring(idR.lastIndexOf('_')+1);
    var idH = $('#h_id'+ numH).val();
    verrutas(idH);
    $('#Cmodal').trigger('click');
  });

  $('.btnDel_pas').click(function(e){
    let idBtnDelp = $(this).attr('id');
    let numFilap = idBtnDelp.substring(idBtnDelp.lastIndexOf('_')+1);
    $('#h_oper'+numFilap).val('Delete');
    $('#btnDel_pas_'+numFilap).hide();
    $('#btnBack_pas_'+numFilap).show();
    $('#btnGuardarHistorial').prop('disabled', false);
  });

  $('.btnBack_pas').click(function( event ) {
    let idBtnBackp = $(this).attr('id');
    let numFilap = idBtnBackp.substring(idBtnBackp.lastIndexOf('_')+1);
    $('#h_oper'+numFilap).val('BD');
    $('#btnDel_pas_'+numFilap).show();
    $('#btnBack_pas_'+numFilap).hide();
    $('#btnGuardarHistorial').prop('disabled', true);
  });

  $("#form_elimH").submit(function(e) {
          // preventing from page reload and default actions
          e.preventDefault();
          $("#form_elimH").addClass("was-validated");
          formDado = "form_elimH";
          if (!$(this)[0].checkValidity()){
              $('#' + formDado + ' .invalid-feedback').each(function () {
                  if ($(this)[0].offsetParent){
                      $(this).parent().find("select, input, textarea").first().focus();
                      return false; // exit each
                  }
              });
              return;
          }
          let referencia = "Registrar.html_form_elimH"
          let typeSubmit = "POST";
          let url = "/api/historial/delete";
          let msg = "Se eliminó correctamente la ruta"
          let ret = "{{ret}}"

            serializedData = JSON.stringify($(this).serializeJSON());
            sendDatosToServer(referencia, url, typeSubmit, ret, serializedData).then((jqXHR) => {
                showMsg(jqXHR[0], referencia, url, ret).then((result) => {
                    if (jqXHR[0].status == 200){
                        $("#form_elimH").removeClass("was-validated");
                        $("#form_elimH").trigger('reset');
                        $('#btnGuardarHistorial').prop('disabled', true);
                        historial();
                    }
                    return true;
                });
            });
      });

</script>    
{% endblock jsfiles %}
</body>
</html>